var h=window.GetParentResourceName?.()??"nui-frame-app",l=async(e,t)=>{try{return await(await fetch(`https://${h}/${e}`,{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8"},body:JSON.stringify(t)})).json()}catch(n){console.error(n)}};function m(e,t="image/png"){return new Promise((n,o)=>{let s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{try{let r=document.createElement("canvas"),a=r.getContext("2d",{alpha:!0});if(!a)throw new Error("Failed to get 2D context.");r.width=s.naturalWidth,r.height=s.naturalHeight,a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(s,0,0),n(r.toDataURL(t)),r.remove()}catch(r){o(r)}finally{s.remove()}},s.onerror=()=>o(new Error("Failed to load image.")),s.src=`https://nui-img/${e}/${e}`})}function p(e){let[t,n]=e.split(","),o=t.match(/:(.*?);/)?.[1]??"image/png",s=atob(n),r=new Uint8Array(s.length);for(let a=0;a<s.length;a++)r[a]=s.charCodeAt(a);return new Blob([r],{type:o})}async function d(e,t){try{let n=p(e),o=new FormData;return o.append("file",n,"mugshot.png"),(await(await fetch(t,{method:"POST",body:o})).json())?.data?.url??null}catch(n){return console.error("Upload failed:",n),null}}var c,i=(e)=>document.getElementById(e),b={lang_header:"header",lang_lastname:"lastname",lang_firstname:"firstname",lang_dob:"dob",lang_sex:"sex",lang_nat:"nat"},g=()=>i("um-idcard"),w=()=>g().classList.add("visible"),v=()=>g().classList.remove("visible"),x=(e)=>{for(let[t,n]of Object.entries(b)){let o=i(t);if(o&&e[n])o.textContent=e[n]}},D=(e)=>{if(!e||e==="none")return"";return e},u=(e)=>{let t=i("badge");if(!e||e==="none"){t.style.display="none";return}i("badgeimg").src=`badges/${e.img}.png`,i("badgegrade").textContent=e.grade,t.style.display="flex"},y=()=>{v(),u("none"),l("close")},C=(e)=>{let t=c.licenses[e.cardtype],n={lastname:e.lastname,name:e.firstname,sign:e.lastname,dob:e.birthdate,sex:e.sex,nationality:e.nationality,cardtype:t.header};for(let[a,f]of Object.entries(n))i(a).textContent=f;let o=D(e.mugShot),s=i("mugshot");s.src=o;let r=c.settings.mugshotScale??1;if(s.style.transform=`scale(${r})`,i("smallmugshot").src=o,g().style.backgroundColor=t.background,u(e.badge),w(),!c.settings.autoClose.status)return;setTimeout(y,c.settings.autoClose.time)},E=async(e)=>{try{let t=await m(e);if(c.mugshotsUpload==="local"){l("convertImageSuccess",{base64:t});return}let n=await l("requestPresignedUrl");if(!n?.url){console.error("No presigned URL");return}let o=await d(t,n.url);if(o)l("convertImageSuccess",{url:o})}catch(t){console.error("Convert/upload failed:",t)}},T=(e)=>{if(e.key!==c.settings.closeKey)return;y()};document.addEventListener("keydown",T);window.addEventListener("DOMContentLoaded",async()=>{let e=await l("jsReady",{});if(!e)return;c=e.configData,x(e.localeData)});window.addEventListener("message",({data:e})=>{if(e.type==="playerData")C(e.playerData);else if(e.type==="convertImage")E(e.txd)});
